(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):(a=a||self,a.shikwasa=b())})(this,function(){'use strict';var o=Math.max,p=Math.min;function a(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){return void c(a)}h.done?b(i):Promise.resolve(i).then(d,e)}function b(b){return function(){var c=this,d=arguments;return new Promise(function(e,f){function g(b){a(i,e,f,g,h,"next",b)}function h(b){a(i,e,f,g,h,"throw",b)}var i=b.apply(c,d);g(void 0)})}}function c(a){var b=Math.floor,c=Math.round;a=c(a);var d=b(a/3600),e=b((a-3600*d)/60),f=b(a-3600*d-60*e);return(e=10>e?"0"+e:e,f=10>f?"0"+f:f,0===d)?"".concat(e,":").concat(f):(d=10>d?"0"+d:d,"".concat(d,":").concat(e,":").concat(f))}function d(a){var b=parseFloat(a).toFixed(2);return"0"===b.slice(-1)?b.slice(0,-1):b}function e(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:60,d=b.offsetWidth-a.offsetWidth;if(0<d){a.setAttribute("data-overflow","");var e=b.offsetWidth/c;a.style.animationDuration="".concat(e,"s")}else a.removeAttribute("data-overflow")}function f(a){var b=Object.assign({},a);b.audio=Object.assign({},a.audio),Object.keys(r).forEach(a=>{b[a]=b[a]||"boolean"==typeof b[a]?b[a]:r[a]}),"function"==typeof b.container&&(b.container=b.container());var c=s.fixedOptions.find(a=>a===b.fixed.type);return c||(b.fixed.type=r.fixed.type),Array.isArray(b.speedOptions)||(b.speedOptions=[b.speedOptions]),-1===b.speedOptions.indexOf(1)&&b.speedOptions.push(1),b.speedOptions=b.speedOptions.map(a=>parseFloat(a)).filter(a=>!isNaN(a)),1<b.speedOptions.length&&b.speedOptions.sort((c,a)=>c-a),b}function g(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},c=Object.assign({},a);return Object.keys(s.audioOptions).forEach(a=>{c[a]=c[a]||b[a]||s.audioOptions[a]}),c}function h(){return i.apply(this,arguments)}function i(){return i=b(function*(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},{tags:c}=(yield j(a.src,b))||{},d=k(c);return g(a,d)}),i.apply(this,arguments)}function j(a,b){return new Promise((c,d)=>{b.read(a,{onSuccess:c,onError:d})})}function k(){var a,b,c,d=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},{title:e,artist:f}=d;if(d.picture&&d.picture.data&&d.picture.format){var g=new Uint8Array(d.picture.data),h=new Blob([g],{type:d.picture.format});a=URL.createObjectURL(h)}return d.TLEN&&d.TLEN.data&&(c=+d.TLEN.data/1e3),d.CHAP&&d.CHAP.length&&(b=d.CHAP.filter(a=>"CHAP"===a.id).map(a=>!!(a.data&&a.data.subFrames&&a.data.subFrames.TIT2)&&{id:a.data.id,startTime:a.data.startTime/1e3,endTime:a.data.endTime/1e3,title:a.data.subFrames.TIT2.data}).sort((c,a)=>c.id-a.id)),{title:e,artist:f,cover:a,duration:c,chapters:b}}function l(a){a.tag=a.tag||"div";var b=document.createElement(a.tag);return a.className&&("string"==typeof a.className?b.classList.add(a.className):a.className.forEach(a=>{b.classList.add(a)})),a.attrs&&Object.keys(a.attrs).forEach(c=>{b.setAttribute(c,a.attrs[c])}),a.innerHTML&&(b.innerHTML=a.innerHTML),b}function m(a,b){return"function"==typeof a.toggleAttribute?void a.toggleAttribute(b):void(a.hasAttribute(b)?a.removeAttribute(b):a.setAttribute(b,""))}function n(a){function b(a){return!!(a&&a!==document&&"HTML"!==a.nodeName&&"BODY"!==a.nodeName&&"classList"in a&&"contains"in a.classList)}function c(a){a.classList.contains("focus-visible")||(a.classList.add("focus-visible"),a.setAttribute("data-focus-visible-added",""))}function d(a){a.hasAttribute("data-focus-visible-added")&&(a.classList.remove("focus-visible"),a.removeAttribute("data-focus-visible-added"))}function e(){l=!1}function f(a){!b(a.target)||l&&c(a.target)}function g(a){!b(a.target)||(a.target.classList.contains("focus-visible")||a.target.hasAttribute("data-focus-visible-added"))&&(m=!0,window.clearTimeout(n),n=window.setTimeout(function(){m=!1},100),d(a.target))}function h(){"hidden"===document.visibilityState&&(m&&(l=!0),i())}function i(){a.addEventListener("mousemove",k),a.addEventListener("mousedown",k),a.addEventListener("mouseup",k),a.addEventListener("pointermove",k),a.addEventListener("pointerdown",k),a.addEventListener("pointerup",k),a.addEventListener("touchmove",k),a.addEventListener("touchstart",k),a.addEventListener("touchend",k)}function j(b){a.removeEventListener("mousemove",k),a.removeEventListener("mousedown",k),a.removeEventListener("mouseup",k),a.removeEventListener("pointermove",b),a.removeEventListener("pointerdown",k),a.removeEventListener("pointerup",k),a.removeEventListener("touchmove",k),a.removeEventListener("touchstart",k),a.removeEventListener("touchend",k)}function k(){l=!1,j()}var l=!0,m=!1,n=null;a.addEventListener("keydown",function(d){d.metaKey||d.altKey||d.ctrlKey||(b(document.activeElement)&&a.contains(document.activeElement)&&c(document.activeElement),l=!0)},!0),a.addEventListener("mousedown",e,!0),a.addEventListener("pointerdown",e,!0),a.addEventListener("touchstart",e,!0),a.addEventListener("visibilitychange",h,!0),i(),a.addEventListener("focus",f,!0),a.addEventListener("blur",g,!0),a.classList.add("js-focus-visible")}var q,r={container:()=>document.querySelector("body"),parser:null,fixed:{type:"auto",position:"bottom"},download:!1,themeColor:"#00869B",theme:"auto",autoPlay:!1,muted:!1,preload:"metadata",speedOptions:[.5,.75,1,1.25,1.5],audio:null},s={fixedOptions:["auto","static","fixed"],audioOptions:{title:"Unknown Title",artist:"Unknown Artist",duration:NaN,cover:null,chapters:[],src:null}},t=null,u=!0;class v{constructor(a){this.mounted=!1,document.querySelector(".shk-icons")||(this.icons=l({className:"shk-icons",innerHTML:"\n  <svg class=\"shk-icons\" xmlns=\"http://www.w3.org/2000/svg\">\n    <symbol id=\"shk-icon_play\" viewbox=\"0 0 64 64\">\n      <path\n        d=\"M32 0a32 32 0 1 1 0 64 32 32 0 0 1 0-64zm-9 17.8c-1 0-1.7.6-1.7 1.4v25.6c0 .8.8 1.4 1.7 1.4 0 0 25-12 26.2-13.1 1-1 .3-1.9.1-2.1z\" />\n    </symbol>\n\n    <symbol id=\"shk-icon_pause\" viewbox=\"0 0 64 64\">\n      <path fill-rule=\"nonzero\"\n        d=\"M32 0a32 32 0 1 0 0 64 32 32 0 0 0 0-64zm-4 40a2 2 0 0 1-2 2h-4a2 2 0 0 1-2-2V24c0-1.1.9-2 2-2h4a2 2 0 0 1 2 2v16zm16 0a2 2 0 0 1-2 2h-4a2 2 0 0 1-2-2V24c0-1.1.9-2 2-2h4a2 2 0 0 1 2 2v16z\" />\n    </symbol>\n\n    <symbol id=\"shk-icon_download\" viewbox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\">\n      <path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3\" />\n    </symbol>\n\n    <symbol id=\"shk-icon_forward\" viewbox=\"0 0 128 139\">\n      <path\n        d=\"M64 11v14h-.8A50 50 0 1 0 114 75h14a64 64 0 1 1-64-64zm16.9 35c6.6 0 11.8 2.7 15.6 8.3a38 38 0 0 1 5.3 21.4c0 9-1.8 16-5.3 21.3-3.8 5.6-9 8.4-15.6 8.4-6.7 0-12-2.8-15.6-8.4A38 38 0 0 1 60 75.7c0-9 1.8-16.1 5.3-21.4C69 48.7 74.2 46 80.9 46zm-32.5 1v57.1H39V58.3a32.3 32.3 0 0 1-13 7V56a34 34 0 0 0 15.4-9h7zm32.5 7c-4.6 0-7.8 2.4-9.6 7.5-1.3 3.5-2 8.2-2 14.2 0 5.9.7 10.6 2 14.1 1.8 5 5 7.6 9.6 7.6 4.5 0 7.7-2.5 9.6-7.6 1.3-3.5 1.9-8.2 1.9-14.1 0-6-.6-10.7-2-14.2-1.8-5.1-5-7.6-9.5-7.6zM64 0l48 19-48 19V0z\" />\n    </symbol>\n\n    <symbol id=\"shk-icon_backward\" viewbox=\"0 0 128 139\">\n      <path\n        d=\"M64 0v11A64 64 0 1 1 0 75h14a50 50 0 1 0 50-50v13L16 19 64 0zm17 45.8c6.6 0 11.8 2.7 15.6 8.3a38 38 0 0 1 5.3 21.3c0 9-1.8 16.1-5.3 21.4a18 18 0 0 1-15.6 8.3c-6.7 0-12-2.8-15.6-8.3a38 38 0 0 1-5.3-21.4c0-9 1.8-16 5.3-21.3 3.7-5.6 8.9-8.3 15.6-8.3zm-32.4 1V104h-9.4V58.2a32.3 32.3 0 0 1-13 7v-9.4a34 34 0 0 0 15.4-9h7zm32.4 7c-4.6 0-7.8 2.5-9.6 7.6-1.3 3.4-2 8.1-2 14.1s.7 10.7 2 14.2c1.8 5 5 7.6 9.6 7.6 4.5 0 7.7-2.6 9.6-7.6 1.3-3.5 2-8.2 2-14.2s-.7-10.7-2-14.1c-2-5.1-5.1-7.6-9.6-7.6z\" />\n    </symbol>\n\n    <symbol id=\"shk-icon_more\" viewbox=\"0 0 64 64\">\n      <path\n        d=\"M8 24a8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8 8 8 0 0 0-8-8zm48 0a8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8 8 8 0 0 0-8-8zm-24 0a8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8 8 8 0 0 0-8-8zm0 0\" />\n    </symbol>\n\n    <symbol id=\"shk-icon_chapter\" viewbox=\"0 0 64 64\">\n      <path d=\"M60.8 55.3H18.1a3.2 3.2 0 1 1 0-6.4h42.8a3.2 3.2 0 0 1 3.1 4.9c-.7 1-1.9 1.6-3.1 1.5zm0-20.2H18.1a3.2 3.2 0 1 1 0-6.4h42.8a3.2 3.2 0 1 1 0 6.4zm0-20H18.1a3.2 3.2 0 1 1 0-6.3h42.8a3.2 3.2 0 0 1 0 6.3zM8.5 12.3a4.2 4.2 0 1 1-8.5 0 4.2 4.2 0 0 1 8.5 0zm0 19.8A4.2 4.2 0 1 1 0 32a4.2 4.2 0 0 1 8.5 0zm0 19.8a4.3 4.3 0 1 1-8.5 0 4.3 4.3 0 0 1 8.5 0zm0 0\"/>\n    </symbol>\n\n    <symbol id=\"shk-icon_unmute\" viewBox=\"0 0 64 66\">\n      <path d=\"M34.3 0c1.5.1 2.6 1.4 2.9 2.8v60.3c-.3 1.4-1.4 2.7-3 2.8-.7.1-1.6-.1-2.6-.7L13.7 50H4.2a4 4 0 0 1-4.1-4V20.6c0-2.2 1.8-4 4-4.1h9.6c.7-.8 17.2-15.1 17.9-15.8 1-.6 1.9-.8 2.6-.7zm6.4 9.3a2 2 0 0 1 2.4-1.6 25.8 25.8 0 0 1 0 50.5l-.4.1a2 2 0 1 1-.4-4.1 21.7 21.7 0 0 0 0-42.5 2 2 0 0 1-1.6-2.4zm4.7 12.8a12.1 12.1 0 0 1 0 21.8 2 2 0 0 1-2.8-1c-.5-1-.1-2.2 1-2.8a8 8 0 0 0 0-14.4 2 2 0 0 1-1-2.7 2 2 0 0 1 2.8-.9zm0 0\"/>\n    </symbol>\n\n    <symbol id=\"shk-icon_mute\" viewBox=\"0 0 64 64\">\n      <path d=\"M33.2 0c-.8 0-1.6.1-2.6.7l-17.4 15H4a4 4 0 0 0-4 4v24.1a4 4 0 0 0 4 4h9.2l17.4 14.5c1 .6 1.8.8 2.6.7 1.4-.1 2.5-1.4 2.8-2.6V2.7C35.7 1.4 34.6 0 33.2 0zm23.2 31.5l6.9-6.8c.7-.6 1-1.5.7-2.4-.2-.8-.9-1.5-1.8-1.7-.8-.2-1.8 0-2.4.7L53 28.1 46 21.3c-.6-.6-1.5-1-2.4-.7-.9.2-1.5.9-1.8 1.7-.2.9.1 1.8.8 2.4l6.9 6.8-7 6.8c-.8 1-.8 2.4.2 3.3.9 1 2.4 1 3.3.1l7-6.8 6.8 6.8c1 .9 2.5.8 3.4 0 1-1 1-2.4 0-3.4l-6.8-6.8zm0 0\"/>\n    </symbol>\n\n    <symbol id=\"shk-icon_triangle\" viewbox=\"0 0 64 64\"><path d=\"M59 29.2L7.8.4A3.2 3.2 0 003 3.2v57.6a3.2 3.2 0 004.8 2.8L59 34.8a3.2 3.2 0 000-5.6z\" /></symbol>\n    <symbol id=\"shk-icon_chart\" viewbox=\"0 0 64 64\"><g transform=\"matrix(1 0 0 -1 0 64)\"><rect x=\"10\" width=\"8\" height=\"54.1\" rx=\"3\"><animate attributeName=\"height\" begin=\"0s\" dur=\"2s\" values=\"64;55;33;5;60;23;58;33;12;14;52;64\" calcMode=\"linear\" repeatCount=\"indefinite\"/></rect><rect x=\"26\" width=\"8\" height=\"32.8\" rx=\"3\"><animate attributeName=\"height\" begin=\"0s\" dur=\"2s\" values=\"50;34;64;23;56;23;34;4;64;54;21;50\" calcMode=\"linear\" repeatCount=\"indefinite\"/></rect><rect x=\"42\" width=\"8\" height=\"42.6\" rx=\"3\"><animate attributeName=\"height\" begin=\"0s\" dur=\"2s\" values=\"30;45;13;64;56;24;45;64;34;23;64;30\" calcMode=\"linear\" repeatCount=\"indefinite\"/></rect></g></symbol>\n    <symbol id=\"shk-icon_close\" viewbox=\"0 0 16 16\"><path d=\"M3.207 14.207a1 1 0 1 1-1.414-1.414l11-11a1 1 0 0 1 1.414 1.414zm11-1.414a1 1 0 0 1-1.414 1.414l-11-11a1 1 0 0 1 1.414-1.414z\"></path></symbol>\n  </svg>\n"})),this.initEl(),this.initOptions(a)}initEl(){var a=this;return b(function*(){a.el=l({className:["shk","shikwasa"],attrs:{"data-name":"shikwasa"},innerHTML:"\n  <div class=\"shk-player\">\n    <div class=\"shk-bar_wrap\">\n      <div class=\"shk-bar\" aria-label=\"progress bar\">\n        <div class=\"shk-bar_loaded\"\n          role=\"progressbar\"\n          aria-label=\"loaded progress\"\n          aria-valuenow=\"0\"\n          aria-valuemin=\"0\"\n          aria-valuemax=\"1\"></div>\n        <div class=\"shk-bar_played\"\n          role=\"progressbar\"\n          aria-label=\"played progress\"\n          aria-valuenow=\"0\"\n          aria-valuemin=\"0\"\n          aria-valuemax=\"1\">\n          <button class=\"shk-bar-handle\"\n            role=\"slider\"\n            aria-label=\"seek progress\"\n            aria-valuenow=\"0\"\n            aria-valuemin=\"0\"\n            aria-orientation=\"horizontal\"\n            aria-valuemax=\"1\"></button>\n        </div>\n      </div>\n    </div>\n    <div class=\"shk-body\">\n      <div class=\"shk-cover\">\n        <div class=\"shk-img\"></div>\n      </div>\n      <div class=\"shk-main\">\n        <div class=\"shk-text\">\n          <div class=\"shk-artist_wrap\">\n            <span class=\"shk-artist\"></span>\n          </div>\n          <div class=\"shk-title_wrap\">\n            <div class=\"shk-title_inner\">\n              <span class=\"shk-title\"></span>\n            </div>\n          </div>\n        </div>\n        <div class=\"shk-controls\">\n          <div class=\"shk-controls_basic\">\n            <button class=\"shk-btn shk-btn_speed\"\n              aria-label=\"toggle playback rate\"\n              title=\"change playback rate\"\n              aria-live=\"polite\">1.0x</button>\n            <button class=\"shk-btn shk-btn_backward\"\n              aria-label=\"rewind 10 seconds\"\n              title=\"rewind 10 seconds\">\n              <svg aria-hidden=\"true\">\n                <use xlink:href=\"#shk-icon_backward\" />\n              </svg>\n            </button>\n            <button class=\"shk-btn shk-btn_toggle\" aria-label=\"toggle play and pause\">\n              <svg class=\"shk-btn_play\" aria-hidden=\"true\">\n                <use xlink:href=\"#shk-icon_play\" />\n              </svg>\n              <svg class=\"shk-btn_pause\" aria-hidden=\"true\">\n                <use xlink:href=\"#shk-icon_pause\" />\n              </svg>\n            </button>\n            <button class=\"shk-btn shk-btn_forward\" aria-label=\"forward 10 seconds\" title=\"forward 10 seconds\">\n              <svg aria-hidden=\"true\">\n                <use xlink:href=\"#shk-icon_forward\" />\n              </svg>\n            </button>\n            <button class=\"shk-btn shk-btn_more\" aria-label=\"more controls\" title=\"more controls\">\n              <svg aria-hidden=\"true\">\n                <use xlink:href=\"#shk-icon_more\" />\n              </svg>\n            </button>\n          </div>\n          <div class=\"shk-controls_extra\">\n            <button class=\"shk-btn shk-btn_volume\" aria-label=\"toggle volume\" title=\"volume\">\n              <svg class=\"shk-btn_unmute\" aria-hidden=\"true\">\n                <use xlink:href=\"#shk-icon_unmute\" />\n              </svg>\n              <svg class=\"shk-btn_mute\" aria-hidden=\"true\">\n                <use xlink:href=\"#shk-icon_mute\" />\n              </svg>\n            </button>\n          </div>\n        </div>\n        <div class=\"shk-display\">\n          <span class=\"shk-loader\" aria-live=\"polite\">\n            <span class=\"shk-visuallyhidden\" tabindex=\"-1\">loading</span>\n            <svg aria-hidden=\"true\" aria-label=\"loading\" aria-live=\"polite\" viewbox=\"0 0 66 66\">\n              <circle cx=\"33\" cy=\"33\" r=\"30\" fill=\"transparent\" stroke=\"url(#shk-gradient)\" stroke-dasharray=\"170\"\n                stroke-dashoffset=\"20\" stroke-width=\"6\" />\n              <lineargradient id=\"shk-gradient\">\n                <stop offset=\"50%\" stop-color=\"currentColor\" />\n                <stop offset=\"65%\" stop-color=\"currentColor\" stop-opacity=\".5\" />\n                <stop offset=\"100%\" stop-color=\"currentColor\" stop-opacity=\"0\" />\n              </lineargradient>\n            </svg>\n          </span>\n          <span class=\"shk-time\">\n            <span class=\"shk-time_now\">--:--</span><span class=\"shk-time_duration\">--:--</span>\n          </span>\n        </div>\n      </div>\n    </div>\n  </div>\n"}),a.playBtn=a.el.querySelector(".shk-btn_toggle"),a.fwdBtn=a.el.querySelector(".shk-btn_forward"),a.bwdBtn=a.el.querySelector(".shk-btn_backward"),a.speedBtn=a.el.querySelector(".shk-btn_speed"),a.moreBtn=a.el.querySelector(".shk-btn_more"),a.muteBtn=a.el.querySelector(".shk-btn_volume"),a.extraControls=a.el.querySelector(".shk-controls_extra"),a.texts=a.el.querySelector(".shk-text"),a.artist=a.el.querySelector(".shk-artist"),a.artistWrap=a.el.querySelector(".shk-artist_wrap"),a.titleWrap=a.el.querySelector(".shk-title_wrap"),a.titleInner=a.el.querySelector(".shk-title_inner"),a.title=a.el.querySelector(".shk-title"),a.currentTime=a.el.querySelector(".shk-time_now"),a.duration=a.el.querySelector(".shk-time_duration"),a.bar=a.el.querySelector(".shk-bar"),a.barWrap=a.el.querySelector(".shk-bar_wrap"),a.audioPlayed=a.el.querySelector(".shk-bar_played"),a.audioLoaded=a.el.querySelector(".shk-bar_loaded"),a.handle=a.el.querySelector(".shk-bar-handle"),a.cover=a.el.querySelector(".shk-cover"),a.seekControls=[a.fwdBtn,a.bwdBtn,a.handle]})()}initOptions(a){this.el.style="--color-primary: ".concat(a.themeColor),this.el.setAttribute("data-theme",a.theme),a.download&&a.audio&&a.audio.src&&(this.downloadBtn=l({tag:"a",className:["shk-btn","shk-btn_download"],attrs:{title:"download","aria-label":"download",href:"string"==typeof a.download?a.download:a.audio.src,download:"",target:"_blank",rel:"noopener noreferrer"},innerHTML:"\n          <svg aria-hidden=\"true\">\n            <use xlink:href=\"#shk-icon_download\" />\n          </svg>\n        "}),this.extraControls.append(this.downloadBtn)),this.el.setAttribute("data-fixed-type",a.fixed.type),"static"!==a.fixed.type&&"top"===a.fixed.position&&this.el.setAttribute("data-fixed-pos",a.fixed.position);var b=a.autoPlay?"playing":"paused";this.el.setAttribute("data-play",b),a.muted&&this.el.setAttribute("data-mute","")}initEvents(){this.moreBtn.addEventListener("click",()=>{m(this.el,"data-extra")}),Array.from(this.extraControls.children).forEach(a=>{this.hideExtraControl(a)}),n(this.el),q=()=>{u&&(u=!1,setTimeout(()=>u=!0,100),e.call(this,this.titleWrap,this.title))},window.addEventListener("resize",q)}setAudioInfo(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};t&&(URL.revokeObjectURL(t),t=null),/blob/.test(a.cover)&&(t=a.cover),this.cover.style.backgroundImage=a.cover?"url(".concat(a.cover,")"):"none",this.title.innerHTML=a.title,this.titleInner.setAttribute("data-title",a.title),this.artist.innerHTML=a.artist,this.currentTime.innerHTML="00:00",this.duration.innerHTML=a.duration?c(a.duration):"00:00",this.downloadBtn&&(this.downloadBtn.href=a.src),this.setBar("loaded",0)}setPlaying(){this.el.setAttribute("data-play","playing")}setPaused(){this.el.setAttribute("data-play","paused"),this.el.removeAttribute("data-loading")}setTime(a,b){this[a].innerHTML=c(b)}setBar(a,b){var c="audio"+a.charAt(0).toUpperCase()+a.substr(1);b=p(b,1),b=o(b,0),this[c].style.width=100*b+"%";var d=b.toFixed(2);this[c].setAttribute("aria-valuenow",d),this.handle.setAttribute("aria-valuenow",d)}setProgress(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;a&&!b?b=c?a/c:0:a=b*(c||0),this.setTime("currentTime",a),this.setBar("played",b)}setSpeed(a){this.speedBtn.innerHTML=d(a)+"x"}getPercentByPos(a){var b=a.clientX||a.changedTouches&&a.changedTouches[0].clientX||0,c=this.barWrap.getBoundingClientRect().left,d=this.barWrap.clientWidth,e=(b-c)/d;return e=p(e,1),e=o(0,e),e}hideExtraControl(a){a.addEventListener("click",()=>{setTimeout(()=>{this.el.removeAttribute("data-extra")},800)})}mount(a){a.innerHTML="",a.append(this.el),this.icons&&a.append(this.icons),this.mounted=!0,this.initEvents(),e(this.titleWrap,this.title)}destroy(){window.removeEventListener("resize",q),t&&URL.revokeObjectURL(t)}}class w{constructor(){this.audioEvents=["abort","canplay","canplaythrough","complete","durationchange","emptied","ended","error","loadeddata","loadedmetadata","loadstart","pause","play","playing","progress","ratechange","seeked","seeking","stalled","suspend","timeupdate","volumechange","waiting"],this.playerEvents=["audioupdate","audioparse"],this.events={}}on(a,b){this.type(a)&&"function"==typeof b&&(!this.events[a]&&(this.events[a]=[]),this.events[a].push(b))}trigger(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};this.events[a]&&this.events[a].length&&this.events[a].forEach(a=>a(b))}type(a){return-1===this.playerEvents.indexOf(a)?-1===this.audioEvents.indexOf(a)?(console.error("Shikwasa: unknown event name: ".concat(a)),null):"audio":"player"}}var x=[],y=[],z="undefined"!=typeof window&&/mobile/i.test(window.navigator.userAgent),A=z?"touchstart":"mousedown",B=z?"touchmove":"mousemove",C=z?"touchend":"mouseup";class D{constructor(a){this.id=x.length,x.push(this),this.comps={},this._audio={},this._hasMediaSession=!1,this._initSeek=0,this._canplay=!1,this._dragging=!1,this.events=new w,this.options=f(a),this.renderComponents(),this.initUI(this.options),this.initAudio(),this.ui.mount(this.options.container)}get duration(){return this.audio&&this.audio.duration?this.audio.duration:this._audio.duration}get seekable(){return!!this.duration}set seekable(a){a?this.ui.seekControls.forEach(a=>{a.removeAttribute("disabled")}):this.ui.seekControls.forEach(a=>{a.setAttribute("disabled","")})}get currentTime(){return this.audio?this.audio.currentTime:void 0}get playbackRate(){return this.audio?this.audio.playbackRate:void 0}set playbackRate(a){this.audio&&(this.audio.playbackRate=a,this.audio.defaultPlaybackRate=a)}get muted(){return this.audio?this.audio.muted:void 0}set muted(a){this.audio&&(this.audio.muted=a,this.audio.defaultMuted=a)}initUI(){this.ui=new v(this.options),this.el=this.ui.el,this.initControlEvents(),this.initBarEvents()}initControlEvents(){this.ui.playBtn.addEventListener("click",()=>{this.toggle()}),this.ui.muteBtn.addEventListener("click",()=>{this.muted=!this.muted,m(this.el,"data-mute")}),this.ui.fwdBtn.addEventListener("click",()=>{this.seekBySpan()}),this.ui.bwdBtn.addEventListener("click",()=>{this.seekBySpan({forward:!1})}),this.ui.speedBtn.addEventListener("click",()=>{var a=this.options.speedOptions.indexOf(this.playbackRate),b=this.options.speedOptions;this.playbackRate=a+1>=b.length?b[0]:b[a+1],this.ui.setSpeed(this.playbackRate)})}initBarEvents(){var a=0,b=a=>{this.ui.setProgress(null,this.ui.getPercentByPos(a),this.duration)},c=d=>{d.preventDefault(),document.removeEventListener(B,b),document.removeEventListener(C,c),a=this.ui.getPercentByPos(d)*this.duration,this.seek(a),this._dragging=!1,setTimeout(()=>this.el.removeAttribute("data-seeking"),50)};this.ui.barWrap.addEventListener(A,a=>{this.seekable&&(a.preventDefault(),this.el.setAttribute("data-seeking",""),this._dragging=!0,document.addEventListener(B,b),document.addEventListener(C,c))}),this.ui.handle.addEventListener("keydown",a=>{if(this.seekable){var b=a.key.replace("Arrow",""),c=["PageDown","PageUp"],d=["Home","End"],e=-1!==["Left","Down"].indexOf(b),f=-1!==["Right","Up"].indexOf(b),g=b===c[0],h=b===c[1],i=b===d[0],j=b===d[1];if(e||f||-1!==c.indexOf(b)||-1!==d.indexOf(b)){if(i)return void this.seek(0);if(j)return void this.seek(this.duration);var k=(h||g?.1:.01)*(f||h?1:-1),l=this._canplay?this.currentTime:this._initSeek,m=k*this.duration+l;this.seek(m)}}})}initAudio(){this.options.audio.src&&(this.audio=new Audio,this.initAudioEvents(),this.events.audioEvents.forEach(a=>{this.audio.addEventListener(a,b=>{this.events.trigger(a,b)})}),this.audio.preload=this.options.preload,this.muted=this.options.muted,this.update(this.options.audio))}initAudioEvents(){this.on("play",()=>{this.ui.setPlaying(),x.forEach(a=>{a.id!==this.id&&a.audio&&!a.audio.paused&&a.pause()})}),this.on("pause",()=>{this.ui.setPaused()}),this.on("ended",()=>{this.ui.setPaused(),this.seek(0)}),this.on("waiting",()=>{this.el.setAttribute("data-loading","")}),this.on("durationchange",()=>{this.duration&&1!==this.duration&&(this.seekable=!0,this.ui.setTime("duration",this.duration))}),this.on("canplay",()=>{this._canplay||(this._canplay=!0,this._initSeek&&(this.seek(this._initSeek),this._initSeek=0))}),this.on("canplaythrough",()=>{this.el.removeAttribute("data-loading")}),this.on("progress",()=>{if(this.audio.buffered.length){var a=this.audio.buffered.length?this.audio.buffered.end(this.audio.buffered.length-1)/this.duration:0;this.ui.setBar("loaded",a)}}),this.on("timeupdate",()=>{this._dragging||this.ui.setProgress(this.audio.currentTime,null,this.duration)}),this.on("abort",()=>{this.ui.setPaused()})}initMediaSession(){if("mediaSession"in navigator){this._hasMediaSession=!0,this.setMediaMetadata(this.options.audio);var a={play:this.play,pause:this.pause,seekforward:this.seekBySpan,seekbackward:()=>this.seekBySpan({forward:!1})};Object.keys(a).forEach(b=>{navigator.mediaSession.setActionHandler(b,()=>{a[b]()})})}}setMediaMetadata(a){var b=a.cover?[{src:a.cover}]:void 0;navigator.mediaSession.metadata=new MediaMetadata({title:a.title,artist:a.artist,artwork:b})}on(a,b){this.events.on(a,b)}play(){if(this.audio.paused){var a=this.audio.play();a instanceof Promise?(a.then(()=>{this.initMediaSession()}),a.catch(a=>{("NotAllowedError"===a.name||"NotSupportedError"===a.name)&&this.pause()})):this.initMediaSession()}}pause(){this.audio.paused||this.audio.pause()}toggle(){this.audio.paused?this.play():this.pause()}seek(a){this.seekable&&(a=parseInt(a),isNaN(a)&&console.error("Shikwasa: seeking time is NaN"),a=p(a,this.duration),a=o(a,0),this.ui.setProgress(a,null,this.duration),this._canplay?this.audio.currentTime=a:this._initSeek=a)}seekBySpan(){var{time:a=10,forward:b=!0}=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},c=this._canplay?this.audio.currentTime:this._initSeek,d=c+a*(b?1:-1);this.seek(d)}update(a){if(a&&a.src)this._audio=g(a),this._canplay=!1,this.audio.src=this._audio.src,this.updateAudioData(this._audio),this.events.trigger("audioupdate",this._audio),!this.options.parser||this._audio.title&&this._audio.artist&&a.cover||h(Object.assign({},a),this.options.parser).then(a=>{this._audio=a||this._audio,this.updateAudioData(this._audio),this.events.trigger("audioparse",this._audio)});else throw new Error("Shikwasa: audio source is not specified")}updateAudioData(a){this.audio.title=a.title,this.ui.setAudioInfo(a),this.seekable=a.duration,this._hasMediaSession&&this.setMediaMetadata(a)}destroyAudio(){this.audio.pause(),this.audio.src="",this.audio.load(),this.audio=null}destroy(){this.destroyAudio(),this.ui.destroy(),Object.keys(this.comps).forEach(a=>{this.comps[a].destroy&&"function"==typeof this.comps[a].destroy&&this.comps[a].destroy()}),this.comps=null,this.options.container.innerHTML=""}renderComponents(){y.length&&y.forEach(a=>{var b=a.name.toLowerCase();this.comps[b]=new a(this)})}}return D.use=function(a){y.push(a)},console.log("%c\uD83C\uDF4A%c Shikwasa Podcast Player v2.0.0-beta.1 %c https://shikwasa.js.org","background-color:#00869B40;padding:4px;","background:#00869B80;color:#fff;padding:4px 0","padding: 2px 0;"),D});//# sourceMappingURL=shikwasa.min.js.map
